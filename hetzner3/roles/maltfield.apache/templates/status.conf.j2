# {{ ansible_managed }}

################################################################################
# File:    status.conf
# Version: 0.1
# Purpose: Sets-up '/server-status' page (eg for ingest by munin)
# Author:  Michael Altfield <michael@michaelaltfield.net>
# Created: 2024-09-11
# Updated: 2024-09-11
################################################################################

<IfModule mod_status.c>
	# Allow server status reports generated by mod_status,
	# with the URL of http://servername/server-status
	# Uncomment and change the "192.0.2.0/24" to allow access from other hosts.

	# Apache gets confused about where the source originates when we pass it 
	# through a proxy (ie nginx & varnish), so we add this env var. This config
	# requires that both the source ip be 127.0.0.1 *and* there be no
	# X-Forwarded-For header set
	SetEnvIF X-Forwarded-For "^$" NotProxied

	<Location /server-status>
		SetHandler server-status
		Require all denied
		<RequireAll>
			Require ip 127.0.0.1
			Require env NotProxied
		</RequireAll>
	</Location>

	# Keep track of extended status information for each request
	ExtendedStatus On

	# Determine if mod_status displays the first 63 characters of a request or
	# the last 63, assuming the request itself is greater than 63 chars.
	# Default: Off
	#SeeRequestTail On

	#<IfModule mod_proxy.c>
	#	# Show Proxy LoadBalancer status in mod_status
	#	ProxyStatus On
	#</IfModule>


</IfModule>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
